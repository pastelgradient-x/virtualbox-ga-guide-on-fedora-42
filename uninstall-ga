# -------- Uninstall Guest Additions --------

# 1. Remove Fedora's Default Guest Additions Packages (and possible leftovers).
sudo dnf remove virtualbox-guest-additions*

# 2. Install Required Build Tools & Libraries (needed to build kernel modules).
sudo dnf install gcc make perl dkms kernel-devel kernel-headers elfutils-libelf-devel bzip2

# 3. Ensure ISO is mounted, otherwise remount.
#    (Via VirtualBox Menu: Devices > Insert Guest Additions CD image).
#    (Also possible by adding it before booting the VM, i recommand this step over the first one).
cd /run/media/$(whoami)/VBox_GAs_7.2.2

# 4. Uninstall Any Existing Guest Additions (from previous installs).
sudo sh ./VBoxLinuxAdditions.run uninstall

# 5. Delete Residual Files and Directories (for a clean slate).
sudo rm -rf /var/lib/VBoxGuestAdditions
sudo rm -rf /opt/VBoxGuestAdditions-*
sudo rm -rf /usr/share/distribution-gpg-keys/virtualbox # optional

# 6. Clean Up Repository and Keys (optional).
rpm -q gpg-pubkey --qf "%{NAME}-%{VERSION}-%{RELEASE}\t%{SUMMARY}\n"   # List registered GPG keys
sudo rm /etc/yum.repos.d/virtualbox.repo                              # Remove VirtualBox repo if exists

# 7. Remove User from Shared Folders Group (if previously added).
sudo gpasswd -d $(whoami) vboxsf
# Optional (Attention: In rare cases with multiple users or typos, it is safer to use 'sudo groupdel vboxsf,' as this command deletes the entire group and its members. It is safe to use because the Bash installer will recreate the group during the installation process.).

# 8. Verify Removal (optional but recommended).
rpm -qa | grep -i virtualbox   # Output should be empty, or only unrelated VirtualBox packages

# 9. Reboot to Complete Removal & Unload Modules.
sudo reboot
# sudo reboot -f (if not working).
